// Generated by CoffeeScript 1.7.1
var GmapsWaypoints,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

GmapsWaypoints = (function() {
  function GmapsWaypoints(element, options) {
    var k;
    this.element = element;
    if (options == null) {
      options = {};
    }
    this.calcRoute = __bind(this.calcRoute, this);
    this.initialize = __bind(this.initialize, this);
    this.directionsService = new google.maps.DirectionsService();
    this.options = {
      latitude: -23.426868,
      longitude: -51.9408231,
      travelMode: 'DRIVING',
      zoom: 13
    };
    for (k in options) {
      this.options[k] = options[k];
    }
  }

  GmapsWaypoints.prototype.initialize = function() {
    var centerMapLatLng, map, mapOptions;
    this.injectCssForMap();
    this.directionsDisplay = new google.maps.DirectionsRenderer();
    centerMapLatLng = new google.maps.LatLng(this.options.latitude, this.options.longitude);
    mapOptions = {
      zoom: this.options.zoom,
      center: centerMapLatLng
    };
    map = new google.maps.Map(this.element, mapOptions);
    return this.directionsDisplay.setMap(map);
  };

  GmapsWaypoints.prototype.injectCssForMap = function() {
    return $(this.element).css('width', '100%').css('height', '100%');
  };

  GmapsWaypoints.prototype.calcRoute = function(origin, locations, destination) {
    var i, request, waypts;
    waypts = [];
    i = 0;
    while (i < locations.length) {
      waypts.push({
        location: this.prepareLocation(locations[i]),
        stopover: true
      });
      i++;
    }
    request = {
      origin: new google.maps.LatLng(origin.latitude, origin.longitude),
      destination: new google.maps.LatLng(destination.latitude, destination.longitude),
      waypoints: waypts,
      optimizeWaypoints: true,
      travelMode: this.options.travelMode
    };
    return this.directionsService.route(request, (function(_this) {
      return function(response, status) {
        if (status === google.maps.DirectionsStatus.OK) {
          return _this.directionsDisplay.setDirections(response);
        }
      };
    })(this));
  };

  GmapsWaypoints.prototype.prepareLocation = function(loc) {
    if (typeof loc === 'string') {
      return loc;
    } else {
      return "" + loc.latitude + ", " + loc.longitude;
    }
  };

  return GmapsWaypoints;

})();
